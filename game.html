<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text RPG Game</title>
  <style>
    body {
      font-family: monospace;
      background-color: #222;
      color: #eee;
      padding: 20px;
    }
    .choices button {
      margin: 10px 5px;
      padding: 10px 15px;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    .choices button:hover {
      background: #666;
    }
  </style>
</head>
<body>

  <h1>üó°Ô∏è The Adventure Begins</h1>
  <div id="text"></div>
  <div class="choices" id="choices"></div>

  <script>
    const game = {
      player: {
        name: "Hero",
        health: 100,
        attack: 10,
        gold: 50,
        level: 1,
        exp: 0,
        inventory: [],
        skills: ["Basic Attack"], // Starting skill
      },
      locations: {
        town: {
          description: "Welcome to the Town. You see a shop and a road leading to the forest.",
          choices: [
            { text: "Visit the shop", next: "shop" },
            { text: "Go to the forest", next: "forest" }
          ]
        },
        shop: {
          description: "You enter the shop. Items available: Healing Potion (10 gold), Sword (50 gold).",
          choices: [
            { text: "Buy Healing Potion (10 gold)", action: "buyHealingPotion", next: "town" },
            { text: "Buy Sword (50 gold)", action: "buySword", next: "town" },
            { text: "Leave the shop", next: "town" }
          ]
        },
        forest: {
          description: "You are in a dark forest. A wild monster appears!",
          choices: [
            { text: "Fight the monster", next: "fightMonster" },
            { text: "Run away", next: "town" }
          ]
        },
      },
      monster: {
        health: 30,
        attack: 10,
      },
      buyHealingPotion() {
        if (this.player.gold >= 10) {
          this.player.gold -= 10;
          this.player.inventory.push("Healing Potion");
          this.showText("You bought a Healing Potion.");
        } else {
          this.showText("You don't have enough gold!");
        }
      },
      buySword() {
        if (this.player.gold >= 50) {
          this.player.gold -= 50;
          this.player.inventory.push("Sword");
          this.player.attack += 5; // Increase attack with the sword
          this.showText("You bought a Sword. Your attack increased!");
        } else {
          this.showText("You don't have enough gold!");
        }
      },
      fightMonster() {
        const monsterHealth = this.monster.health;
        let playerAttack = Math.floor(Math.random() * 20) + this.player.attack; // Regular attack
        const basicAttack = this.player.skills.includes("Basic Attack") ? 15 : 0; // Basic attack damage
        let monsterAttack = this.monster.attack;

        this.showText("Choose your action: 1. Basic Attack  2. Regular Attack");

        // Show combat choices (buttons for the user to choose)
        this.showChoices([
          { text: "Use Basic Attack", action: "basicAttack", next: "combatOutcome" },
          { text: "Use Regular Attack", action: "regularAttack", next: "combatOutcome" },
        ]);
      },

      basicAttack() {
        this.player.attackMonster(15); // Basic attack deals 15 damage
      },

      regularAttack() {
        let damage = Math.floor(Math.random() * 20) + this.player.attack; // Random attack between range
        this.player.attackMonster(damage);
      },

      attackMonster(damage) {
        this.monster.health -= damage;
        this.showText(`You dealt ${damage} damage to the monster!`);

        // Monster attacks back
        this.monsterAttacks();

        // Check if the monster is defeated
        if (this.monster.health <= 0) {
          this.showText("You defeated the monster!");
          this.player.exp += 20;
          this.player.gold += 20;
          this.checkLevelUp();
          this.showChoices([{ text: "Go back to town", next: "town" }]);
        }

        // Check if the player is defeated
        if (this.player.health <= 0) {
          this.showText("You have been defeated by the monster. Game over.");
        }
      },

      monsterAttacks() {
        let damage = this.monster.attack;
        this.player.health -= damage;
        this.showText(`The monster attacks you for ${damage} damage!`);
      },

      checkLevelUp() {
        if (this.player.exp >= 100) {
          this.player.level++;
          this.player.health += 20;
          this.player.attack += 5;
          this.player.exp = 0; // Reset EXP after leveling up
          this.showText(`You leveled up! You are now level ${this.player.level}.`);
          this.unlockSkills();
        }
      },

      unlockSkills() {
        if (this.player.level >= 5 && !this.player.skills.includes("Special Attack")) {
          this.player.skills.push("Special Attack");
          this.showText("You gained a new skill: Special Attack!");
        }
      },

      showText(text) {
        document.getElementById("text").innerText = text;
      },

      showChoices(choices) {
        const choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML = "";
        choices.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice.text;
          btn.onclick = () => {
            if (choice.action) {
              this[choice.action]();  // Execute the action for the choice
            }
            this.showNode(choice.next); // Show the next node or outcome
          };
          choicesDiv.appendChild(btn);
        });
      },

      showNode(nodeKey) {
        const node = this.locations[nodeKey];
        this.showText(node.description);
        this.showChoices(node.choices);
      }
    };

    game.showNode("town"); // Start at the town
  </script>
</body>
</html>
