<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Old School RPG</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #0f0;
      padding: 20px;
    }
    button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      background-color: #222;
      color: #0f0;
      border: 1px solid #0f0;
      cursor: pointer;
    }
    button:hover {
      background-color: #333;
    }
  </style>
</head>
<body>
  <h1>Old School RPG</h1>
  <pre id="gameText">Welcome to the game.</pre>
  <div id="choices"></div>
  <p><strong>Gold:</strong> <span id="goldDisplay">0</span></p>

  <script>
    const game = {
      player: {
        name: "Hero",
        level: 1,
        exp: 0,
        expToLevel: 20,
        health: 100,
        maxHealth: 100,
        gold: 50,
        attack: 10,
        defense: 5,
        skills: ["Fireball"],
        inventory: [],
      },
      currentMonster: null,

      start() {
        this.showText("You awaken in a mysterious town.");
        this.showChoices([
          { text: "Go to the forest", next: "forest" },
          { text: "Visit the shop", next: "shop" },
          { text: "View inventory", action: "showInventory" },
          { text: "View stats", action: "showStats" }
        ]);
        this.updateGoldDisplay();
      },

      goTo(next) {
        switch (next) {
          case "forest":
            this.fightMonster();
            break;
          case "shop":
            this.enterShop();
            break;
          case "town":
            this.start();
            break;
        }
      },

      fightMonster() {
        const monster = this.getRandomMonster();
        this.currentMonster = { ...monster };
        this.showText(`A wild ${monster.name} appears!\nHealth: ${monster.health}`);
        this.showChoices([
          { text: "Attack", action: "combat" },
          { text: "Flee", action: "fleeBattle" }
        ]);
      },

      getRandomMonster() {
        const monsters = [
          { name: "Slime", health: 20, attack: 5, reward: { exp: 10, gold: 10 }},
          { name: "Goblin", health: 30, attack: 8, reward: { exp: 15, gold: 15 }},
          { name: "Orc", health: 50, attack: 12, reward: { exp: 25, gold: 30 }},
        ];
        return monsters[Math.floor(Math.random() * monsters.length)];
      },

      combat() {
        const monster = this.currentMonster;
        if (!monster) return;

        const playerAttack = Math.floor(Math.random() * 10) + this.player.attack;
        const monsterAttack = Math.floor(Math.random() * monster.attack);

        monster.health -= playerAttack;
        let combatLog = `You deal ${playerAttack} damage to the ${monster.name}.\n`;

        if (monster.health <= 0) {
          combatLog += `You defeated the ${monster.name}! You gain ${monster.reward.exp} EXP and ${monster.reward.gold} gold.`;
          this.player.exp += monster.reward.exp;
          this.player.gold += monster.reward.gold;
          this.checkLevelUp();
          this.currentMonster = null;
          this.showText(combatLog);
          this.showChoices([{ text: "Return to town", next: "town" }]);
          return;
        }

        this.player.health -= Math.max(0, monsterAttack - this.player.defense);
        combatLog += `${monster.name} hits you for ${monsterAttack} damage.\nYour health: ${this.player.health}`;

        if (this.player.health <= 0) {
          this.showText("You have been defeated. Game over.");
          this.showChoices([]);
        } else {
          this.showText(combatLog);
          this.showChoices([
            { text: "Attack again", action: "combat" },
            { text: "Flee", action: "fleeBattle" }
          ]);
        }

        this.updateGoldDisplay();
      },

      fleeBattle() {
        this.showText("You fled back to town.");
        this.showChoices([{ text: "Return", next: "town" }]);
      },

      enterShop() {
        this.showText("Welcome to the shop. What would you like to buy?");
        this.showChoices([
          { text: "Sword (+5 atk) – 30g", action: "buyItem", item: { name: "Sword", attack: 5, cost: 30 } },
          { text: "Shield (+3 def) – 25g", action: "buyItem", item: { name: "Shield", defense: 3, cost: 25 } },
          { text: "Health Potion (restore 50) – 20g", action: "buyItem", item: { name: "Health Potion", heal: 50, cost: 20 } },
          { text: "Leave shop", next: "town" }
        ]);
      },

      buyItem(choice) {
        const item = choice.item;
        if (this.player.gold >= item.cost) {
          this.player.gold -= item.cost;
          this.player.inventory.push(item);
          if (item.attack) this.player.attack += item.attack;
          if (item.defense) this.player.defense += item.defense;
          if (item.heal) {
            this.player.health = Math.min(this.player.maxHealth, this.player.health + item.heal);
          }
          this.showText(`You bought ${item.name}.`);
        } else {
          this.showText("Not enough gold.");
        }
        this.updateGoldDisplay();
        this.enterShop();
      },

      checkLevelUp() {
        while (this.player.exp >= this.player.expToLevel) {
          this.player.exp -= this.player.expToLevel;
          this.player.level++;
          this.player.expToLevel = Math.floor(this.player.expToLevel * 1.5);
          this.player.attack += 2;
          this.player.defense += 1;
          this.player.maxHealth += 20;
          this.player.health = this.player.maxHealth;
          this.player.skills.push("Power Strike");
          this.showText(`You leveled up to level ${this.player.level}!\n+2 Attack, +1 Defense, +20 Health\nNew skill: Power Strike!`);
        }
      },

      showInventory() {
        const items = this.player.inventory.map(i => i.name).join(", ") || "Empty";
        this.showText("Inventory:\n" + items);
        this.showChoices([{ text: "Back", next: "town" }]);
      },

      showStats() {
        const p = this.player;
        this.showText(`Stats:
Level: ${p.level}
EXP: ${p.exp}/${p.expToLevel}
Health: ${p.health}/${p.maxHealth}
Attack: ${p.attack}
Defense: ${p.defense}
Gold: ${p.gold}
Skills: ${p.skills.join(", ")}`);
        this.showChoices([{ text: "Back", next: "town" }]);
      },

      showText(text) {
        document.getElementById("gameText").textContent = text;
      },

      showChoices(choices) {
        const container = document.getElementById("choices");
        container.innerHTML = "";
        choices.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice.text;
          btn.onclick = () => {
            if (choice.next) this.goTo(choice.next);
            else if (choice.action === "combat") this.combat();
            else if (choice.action === "fleeBattle") this.fleeBattle();
            else if (choice.action === "buyItem") this.buyItem(choice);
            else if (choice.action === "showInventory") this.showInventory();
            else if (choice.action === "showStats") this.showStats();
          };
          container.appendChild(btn);
        });
      },

      updateGoldDisplay() {
        document.getElementById("goldDisplay").textContent = this.player.gold;
      }
    };

    game.start();
  </script>
</body>
</html>
